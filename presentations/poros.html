<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>POROs That Make Your Rails App Soar-os</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">POROs That Make Your Rails App Soar-os</h1>
</div>
<div id="about-me" class="slide section level3">
<h1>About Me</h1>
</div>
<div class="slide section level3">

<p>Financeit is hiring a Senior Mobile Dev (Hybrid iOS/Android)</p>
<p>https://www.financeit.io/careers-apply-today-financeit/</p>
</div>
<div id="these-slides" class="slide section level3">
<h1>These Slides</h1>
<p>Available on my Github pages:
skipants.github.io/presentations/poros.html</p>
<p><img src="img/poros_qr_code.png" /></p>
</div>
<div id="what-are-poros" class="slide section level3">
<h1>What are POROs?</h1>
</div>
<div id="what-are-poros-1" class="slide section level3">
<h1>What are POROs?</h1>
<p><strong>Plain Old Ruby Object</strong></p>
<p>POROs are just objects that do something very simple without any
extra functionality.</p>
</div>
<div id="why-poros" class="slide section level3">
<h1>Why POROs?</h1>
</div>
<div id="why-poros-1" class="slide section level3">
<h1>Why POROs?</h1>
<p><em>“Programs must be written for people to read, and only
incidentally for machines to execute.”</em> — Harold Abelson</p>
<p>Different categories of POROs become <strong>conventional
abstractions</strong></p>
</div>
<div id="conventional-abstractions" class="slide section level3">
<h1>Conventional Abstractions</h1>
</div>
<div id="conventional-abstractions-1" class="slide section level3">
<h1>Conventional Abstractions</h1>
<p>An agreement within a group of developers on ways of separating
code</p>
</div>
<div id="conventional-abstractions-2" class="slide section level3">
<h1>Conventional Abstractions</h1>
<p>Because POROs are <strong>conventional abstractions</strong>, once
you understand how a category of POROs works, you can easily extrapolate
their use to other parts of your application.</p>
</div>
<div id="conventional-abstractions-3" class="slide section level3">
<h1>Conventional Abstractions</h1>
<ul>
<li>Saves time understanding code</li>
<li>Reduces mental overhead</li>
<li>Helps guide where new code should go</li>
<li>Makes change simpler</li>
</ul>
</div>
<div id="poros-ill-show-you" class="slide section level3">
<h1>POROs I’ll Show You</h1>
<ul>
<li>Models</li>
<li>Forms</li>
<li>Services</li>
<li>Connections</li>
<li>Queries</li>
</ul>
</div>
<div id="models" class="slide section level3">
<h1>Models</h1>
</div>
<div id="models-1" class="slide section level3">
<h1>Models</h1>
<h4 id="what">What</h4>
<p>PORO that contains domain-specific data and exposes different
representations of that data.</p>
<p>AKA Value Objects</p>
</div>
<div id="models-2" class="slide section level3">
<h1>Models</h1>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="dt">CreditCard</span> <span class="op">=</span> <span class="dt">Struct</span><span class="at">.new</span>(<span class="wa">:number</span>, <span class="wa">:cvv</span>, <span class="wa">:expiration_date</span>) <span class="cf">do</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="co"># Assume parameters from the client of the form:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="co">#   &quot;creditCard&quot;: {</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="co">#     &quot;number&quot;: &quot;9999-9999-9999-9999&quot;,</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="co">#     &quot;cvv&quot;: &quot;123&quot;,</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="co">#     &quot;expMonth:&quot; 9,</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="co">#     &quot;expYear&quot;: 27,</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="co">#   }</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.from_params</span>(params)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    expiration_date <span class="op">=</span> <span class="dt">Date</span><span class="at">.new</span>(params<span class="kw">[</span><span class="st">&quot;expYear&quot;</span><span class="kw">]</span> <span class="op">+</span> <span class="dv">2000</span>, params<span class="kw">[</span><span class="st">&quot;expMonth&quot;</span><span class="kw">]</span>, <span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    new(params<span class="kw">[</span><span class="st">&quot;number&quot;</span><span class="kw">]</span>, params<span class="kw">[</span><span class="st">&quot;cvv&quot;</span><span class="kw">]</span>, expiration_date)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="cf">def</span> visa?</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    number<span class="at">.starts_with?</span>(<span class="st">&quot;4&quot;</span>)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>  <span class="cf">def</span> mastercard?</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    number<span class="at">.starts_with?</span>(<span class="st">&quot;5&quot;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div id="models-3" class="slide section level3">
<h1>Models</h1>
<h4 id="why">Why</h4>
<ul>
<li>Easy to pass this data around</li>
<li>Unrelated parts of the code that use this data do not need to
understand its internals
<ul>
<li>Especially when the data comes from different sources</li>
</ul></li>
<li>Helps break out this functionality that usually ends up in
models</li>
<li>Adding new representations of this data is simply a new method
<ul>
<li>eg. What would <code>expired?</code> look like in our example?</li>
</ul></li>
</ul>
</div>
<div id="models-4" class="slide section level3">
<h1>Models</h1>
<h4 id="notes-on-usage">Notes on Usage</h4>
<ul>
<li>I like to just put these in <code>/app/models</code> even though
they aren’t DB backed
<ul>
<li>If you or your team does not like that, use
<code>/app/values/</code> instead.</li>
</ul></li>
<li>Try and keep these pure</li>
<li>Use class methods as constructors to handle different sources of the
data</li>
<li>Use public methods as representations of the data</li>
<li>Use with <code>Rails::Aggregations#composed_of</code> to get huge
ergonomic gains
<ul>
<li>https://thoughtbot.com/blog/rails-value-objects</li>
</ul></li>
</ul>
</div>
<div id="forms" class="slide section level3">
<h1>Forms</h1>
</div>
<div id="forms-1" class="slide section level3">
<h1>Forms</h1>
<h4 id="what-1">What</h4>
<p>PORO that takes data input from a third-party and:</p>
<ol style="list-style-type: decimal">
<li>validates the data</li>
<li>transforms it into a more useful data type</li>
</ol>
<p>AKA <code>Parameters</code> or <code>Inputs</code></p>
</div>
<div id="forms-2" class="slide section level3">
<h1>Forms</h1>
<div class="sourceCode" id="cb2"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="dt">CreateOrderForm</span> <span class="op">=</span> <span class="dt">Struct</span><span class="at">.new</span>(<span class="wa">:params</span>) <span class="cf">do</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="fu">include</span> <span class="dt">ActiveModel</span><span class="op">:</span><span class="wa">:Validations</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  validates <span class="wa">:age</span>, <span class="wa">numericality:</span> <span class="op">{</span> <span class="wa">greater_than_or_equal_to:</span> <span class="dv">18</span> <span class="op">}</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="cf">def</span> items</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="ot">@items</span> <span class="op">||=</span> <span class="dt">Item</span><span class="at">.where</span>(<span class="wa">id:</span> params<span class="kw">[</span><span class="st">&quot;itemIds&quot;</span><span class="kw">]</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="cf">def</span> age</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    params<span class="kw">[</span><span class="st">&quot;age&quot;</span><span class="kw">]</span><span class="at">.to_i</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>  <span class="cf">def</span> agrees_to_terms?</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>    params<span class="kw">[</span><span class="st">&quot;tos_agree&quot;</span><span class="kw">]</span> <span class="op">==</span> <span class="st">&quot;1&quot;</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>  <span class="cf">def</span> credit_card</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>    <span class="ot">@credit_card</span> <span class="op">||=</span> <span class="dt">CreditCard</span><span class="at">.from_params</span>(params<span class="kw">[</span><span class="st">&quot;creditCard&quot;</span><span class="kw">]</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div id="forms-3" class="slide section level3">
<h1>Forms</h1>
<h4 id="why-1">Why</h4>
<ul>
<li>Helps handle small annoyances with cleaning data
<ul>
<li>eg. Rails form checkbox sending “0” or “1” to the backend</li>
</ul></li>
<li>Validates data before you do any sort of processing with it</li>
<li>Rest of application can be guaranteed that the data is of a certain
format without extra checks</li>
</ul>
</div>
<div id="forms-4" class="slide section level3">
<h1>Forms</h1>
<h4 id="usage-notes">Usage Notes</h4>
<ul>
<li>You may have heard about these before, but this use case is
simpler</li>
<li>Try and keep these pure</li>
<li>Use models to abstract complex data
<ul>
<li>Consider validating against the model, too!</li>
</ul></li>
</ul>
</div>
<div id="services" class="slide section level3">
<h1>Services</h1>
</div>
<div id="services-1" class="slide section level3">
<h1>Services</h1>
<h4 id="what-2">What</h4>
<p>Generic POROs that provide a layer of business logic between
controllers and models</p>
</div>
<div id="services-2" class="slide section level3">
<h1>Services</h1>
<div class="sourceCode" id="cb3"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="cf">class</span> <span class="dt">CreateOrder</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.call</span>(order_form, current_user)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">[</span><span class="wa">:invalid</span>, order_form<span class="at">.errors</span><span class="kw">]</span> <span class="cf">unless</span> order_form<span class="at">.valid?</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    order_status <span class="op">=</span> <span class="cf">if</span> order_form<span class="at">.agrees_to_terms?</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>      <span class="dt">FillOrder</span><span class="at">.call</span>(current_user)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      <span class="wa">:processed</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>      <span class="dt">HoldOrder</span><span class="at">.call</span>(current_user)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>      <span class="wa">:on_hold</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>    order <span class="op">=</span> <span class="dt">Order</span><span class="at">.create</span>(<span class="wa">order_status:</span> order_status, <span class="wa">items:</span> order_form<span class="at">.items</span>, <span class="wa">user:</span> current_user)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>    <span class="kw">[</span><span class="wa">:ok</span>, order<span class="kw">]</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div id="services-3" class="slide section level3">
<h1>Services</h1>
<h4 id="why-2">Why</h4>
<ul>
<li>Helps keeps controllers and models from exploding in size</li>
<li>Isolates complexity</li>
<li>Help business logic become composable</li>
</ul>
</div>
<div id="services-4" class="slide section level3">
<h1>Services</h1>
<h4 id="notes-on-usage-1">Notes on Usage</h4>
<ul>
<li>Services are going to be an entrypoint into a lot of other code</li>
<li>Expect these classes to get a little hairy with a lot of business
logic</li>
<li>Use the other POROs to whittle down at this complexity</li>
</ul>
</div>
<div id="connections" class="slide section level3">
<h1>Connections</h1>
</div>
<div id="connections-1" class="slide section level3">
<h1>Connections</h1>
<h4 id="what-3">What</h4>
<p>Provide an adapter between an API and your business logic</p>
</div>
<div id="connections-2" class="slide section level3">
<h1>Connections</h1>
<div class="sourceCode" id="cb4"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="cf">class</span> <span class="dt">CreditCardInc</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.pre_authed?</span>(credit_card, amount)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    params <span class="op">=</span> <span class="op">{</span> <span class="st">&quot;no&quot;</span> <span class="op">=&gt;</span> credit_card<span class="at">.number</span>, <span class="st">&quot;cvv&quot;</span> <span class="op">=&gt;</span> credit_card<span class="at">.cvv</span>, <span class="st">&quot;cost&quot;</span> <span class="op">=&gt;</span> amount <span class="op">}</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    response <span class="op">=</span> conn<span class="at">.post</span>(<span class="st">&quot;https://example.com/credit_card/preauth&quot;</span>, <span class="wa">json:</span> params)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    response<span class="at">.status</span> <span class="op">==</span> <span class="dv">200</span> <span class="op">&amp;&amp;</span> <span class="cn">JSON</span><span class="at">.parse</span>(response<span class="at">.body</span>)<span class="kw">[</span><span class="wa">:status</span><span class="kw">]</span> <span class="op">==</span> <span class="st">&quot;ok&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.charge</span>(credit_card, user, amount)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    params <span class="op">=</span> <span class="op">{</span> <span class="st">&quot;no&quot;</span> <span class="op">=&gt;</span> credit_card<span class="at">.number</span>, <span class="st">&quot;cvv&quot;</span> <span class="op">=&gt;</span> credit_card<span class="at">.cvv</span>, <span class="st">&quot;postalCode&quot;</span> <span class="op">=&gt;</span> user<span class="at">.postal_code</span>, <span class="st">&quot;cost&quot;</span> <span class="op">=&gt;</span> amount <span class="op">}</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>    response <span class="op">=</span> conn<span class="at">.post</span>(<span class="st">&quot;https://example.com/credit_card/charge&quot;</span>, <span class="wa">json:</span> params)</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>    <span class="dt">Charge</span><span class="at">.from_api_response</span>(response)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.conn</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>    <span class="cn">HTTPX</span><span class="at">.with</span>(<span class="wa">headers:</span> <span class="op">{</span> <span class="st">&quot;authorization&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;Bearer b7d03a6947b217efb6f3ec3bd3504582&quot;</span> <span class="op">}</span>)</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div id="connections-3" class="slide section level3">
<h1>Connections</h1>
<h4 id="why-3">Why</h4>
<ul>
<li>Isolates extra code used to transform responses from APIs to
something your application cares about</li>
<li>Give a convention for how devs should make remote requests</li>
<li>Delineates remote requests from the rest of your app logic
<ul>
<li>Reduce the blast radius of complex APIs</li>
<li>As a bonus, you can easily stub all Connection methods to avoid
requests in your test suite</li>
</ul></li>
</ul>
</div>
<div id="connections-4" class="slide section level3">
<h1>Connections</h1>
<h4 id="notes-on-usage-2">Notes on Usage</h4>
<ul>
<li>Use a <code>Connection</code> superclass to abstract out request
generalities
<ul>
<li>eg. Normalize timeouts, circuit breaker implementations across many
API requests</li>
</ul></li>
<li>Don’t be afraid to call the same endpoint in different methods</li>
<li>Also a useful abstraction outside of Rails</li>
</ul>
</div>
<div id="queries" class="slide section level3">
<h1>Queries</h1>
</div>
<div id="queries-1" class="slide section level3">
<h1>Queries</h1>
<h4 id="what-4">What</h4>
<p>Encapsulations of complicated database queries, including control
flow</p>
</div>
<div id="queries-2" class="slide section level3">
<h1>Queries</h1>
<div class="sourceCode" id="cb5"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">class</span> <span class="dt">AvailableItemsQuery</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="cf">def</span> <span class="dv">self</span><span class="at">.call</span>(item_ids, user)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    available_items <span class="op">=</span> <span class="dt">Item</span><span class="at">.join</span>(<span class="wa">:inventories</span>)<span class="at">.where</span>(<span class="wa">id:</span> item_ids)<span class="at">.where</span>(<span class="st">&quot;items.quantity &gt; 0&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="cf">return</span> available_items <span class="cf">unless</span> user<span class="at">.premium_subscriber?</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    <span class="cf">if</span> available_items<span class="at">.count</span> <span class="op">&lt;</span> item_ids<span class="at">.length</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>      <span class="dt">Item</span><span class="at">.where</span>(<span class="wa">id:</span> item_ids)<span class="at">.joins</span>(<span class="wa">:shipping_manifest</span>)</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>          <span class="at">.where</span>(<span class="st">&quot;shipping_manifests.receive_date &lt; ?&quot;</span>, <span class="dv">2</span><span class="at">.weeks.from_now</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      available_items</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
</div>
<div id="queries-3" class="slide section level3">
<h1>Queries</h1>
<h4 id="why-4">Why</h4>
<ul>
<li>Give you room to break out of an ORM to do logic in code or in
SQL</li>
<li>Since all pure SQL lives in one place, you know where to look before
DB upgrades or transitions</li>
<li>Optimizing queries become easier because you can easily test the
boundaries</li>
</ul>
</div>
<div id="queries-4" class="slide section level3">
<h1>Queries</h1>
<h4 id="notes-on-usage-3">Notes on Usage</h4>
<ul>
<li>Use queries as read-only so that they are pure methods
<ul>
<li>move write queries to services</li>
<li>or make write queries explicit in some way</li>
</ul></li>
<li>Consider a Query superclass or testing abstraction that can
instrument your queries and help debug performance issues</li>
<li>Return ActiveRecord::Relations so that you can continue to chain off
the query result</li>
</ul>
</div>
<div id="big-picture-example-if-time" class="slide section level3">
<h1>Big Picture Example (if time)</h1>
</div>
<div id="summary" class="slide section level3">
<h1>Summary</h1>
<p>Combining all of these POROs keeps your controllers AND models
skinny.</p>
<p>Your Rails controllers now only care about routing traffic and
returning responses</p>
<p>Your Rails models now only represent the data contained in their
table</p>
<p>Both have their complexity completely reduced</p>
</div>
<div class="slide section level3">

<div class="float">
<img src="img/snl-david-pumpkins.jpg" alt="Any Questions?" />
<div class="figcaption">Any Questions?</div>
</div>
</div>
</body>
</html>
